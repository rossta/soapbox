Simple=(function(e,g,h){var c=e,f="prototype",b={generate:function(){var k,i,j;sandbox=new c.Sandbox();sandbox.add(c.Author).add(c.Slideshow).add(c.KeyListener).init();Simple.app=sandbox;return sandbox}},d=function(){if(window.console&&window.console.log&&typeof window.console.log.apply=="function"){window.console.log.apply(window.console,arguments)}},a=function(i){return throwdown(i).toHtml()};c.Sandbox=function(){this.modules=[]};c.Sandbox[f]={add:function(i){var j=new i();j.sandbox=this;this.modules.push(j);return this},init:function(){var i=this;this.archive=new c.Archive();i.forEach("init");g("a.toggle").bind("click",function(){i.forEach("toggle")});this.bind("toggle.simple",function(){i.forEach("toggle")})},trigger:function(i,j){return g(document).trigger(i,j)},bind:function(i,j){return g(document).bind(i,j)},forEach:function(i){g.map(this.modules,function(j){if(typeof j[i]=="function"){j[i]()}})},load:function(i){return this.archive.load(i)},get:function(i){return this.archive.get(i)},save:function(j,i){return this.archive.save(j,i)},all:function(i){return this.archive.all(i)},clear:function(){return this.archive.clear()},slides:function(){return this.archive.slides()}};c.Author=function(i){i=i||"#author";this.selector=i;this.$selector=g(i);this.$preview=this.$selector.find("#preview");this.$textarea=this.$selector.find("textarea");this.$paginate=this.$selector.find("#pagination")};c.Author[f]={init:function(){this.listen();this.load("demo");this.display(0)},listen:function(){var i=this;this.$selector.delegate("textarea","keyup change",function(){var k=g(this),j=k.val();slideId=k.attr("name");g("#"+slideId).html(a(j));i.sandbox.save(slideId.split("_")[1],j)}).delegate("#preview","click",function(){g(this).next().find("textarea").focus()}).delegate("a.play","click",function(){i.sandbox.trigger("play.simple");return false}).delegate("a.insert","click",function(){i.insert(i.$preview.children().length,"# New Slide");return false}).delegate("a.new","click",function(){var j=prompt("Save New Slideshow As...");if(j){i.$preview.empty();i.$paginate.empty();i.load(j);i.insert(0,"# New Slideshow");i.show()}return false}).delegate("#pagination a","click",function(){i.display(parseInt(g(this).html(),10)-1);return false})},hide:function(){return this.$selector.hide()},show:function(){return this.$selector.show()},display:function(j,l){var i=this,k="slide_"+j;l=l||i.sandbox.get(j);g("div.slide").hide();g("[id$="+k+"]").show();i.$paginate.children().removeClass("current").filter(":eq("+j+")").addClass("current");i.$textarea.attr("name",k).val(l);i.$textarea.change();return this},insert:function(j,k){var i=this;g("<div></div>").attr("id","slide_"+j).attr("class","slide card padding").html(a(k)).appendTo(i.$preview).hide();g("<a href='#'></a>").html(j+1).appendTo(i.$paginate);i.sandbox.save(j,k);i.display(j);return this},toggle:function(){return this.$selector.toggle()},load:function(j){var i=this;i.sandbox.load(j);i.sandbox.all(function(k){i.insert(parseInt(k.num,10),k.markdown)})}};c.Slideshow=function(i){i=i||"#slideshow";this.selector=i;this.$selector=g(i);this.$screen=g("#screen")};c.Slideshow[f]={init:function(){this.hide();this.listen()},listen:function(){var i=this;this.$selector.delegate("a.exit","click",function(){i.sandbox.trigger("stop.simple")});i.sandbox.bind("play.simple",function(){i.play()}).bind("loaded.simple",function(k,j){i.show()}).bind("next.simple",function(){i.next()}).bind("prev.simple",function(){i.prev()})},hide:function(){return this.$selector.hide()},show:function(){return this.$selector.show()},toggle:function(){return this.$selector.toggle()},play:function(){var i=this;i.$screen.empty();i.sandbox.all(function(j){g("<div></div>").attr("id","simple"+j.slideId).html(a(j.markdown)).appendTo(i.$screen).hide()});i.sandbox.trigger("loaded.simple");i.$screen.children().addClass("slide").first().cell()},next:function(){var i=this.$screen.children(":visible").hide().next();if(i.length){i.cell()}else{self.sandbox.trigger("stop.simple").trigger("toggle.simple")}},prev:function(){var i=this.$screen.children(":visible").hide().prev();if(i.length){i.cell()}else{self.sandbox.trigger("stop.simple").trigger("toggle.simple")}}};c.Archive=function(){this.db=c.Archive.connection};c.Archive[f]={save:function(j,i){d("Saving",j,i);this.slides[j]=i;this.store()},get:function(i){return this.slides[i]},all:function(k){var i=0,j=this.slides[i];while(j){k({num:i,markdown:j});j=this.slides[++i]}return this},retrieve:function(i){var j=this.db[this.key];if(j){return JSON.parse(j)}else{if(i=="demo"){j=["# Simply slides","# Using markdown"]}else{j=[]}return j}},store:function(){this.db[this.key]=JSON.stringify(this.slides);return this},load:function(i){this.key=i;this.slides=this.retrieve(this.key);return this},slides:function(){return this.slides},clear:function(){try{this.db.clear()}catch(i){c.Archive.connection=window.localStorage||{}}}};c.Archive.connection=window.localStorage||{};c.KeyListener=function(){this.EDIT="edit";this.SHOW="show";this.context=this.EDIT};c.KeyListener[f]={keys:{space:32,left:37,right:39,esc:27},init:function(){var i=this,j=i.keys;i.sandbox.bind("play.simple",function(){i.context=i.SHOW}).bind("stop.simple",function(){i.context=i.EDIT}).bind("keydown",function(l){var k=l.keyCode;switch(i.context){case i.EDIT:d("keydown while editing");break;case i.SHOW:switch(k){case j.space:d("space");break;case j.left:i.sandbox.trigger("prev.simple");break;case j.right:i.sandbox.trigger("next.simple");break;case j.esc:i.sandbox.trigger("stop.simple");i.sandbox.trigger("toggle.simple");break;default:d(k);break}break}})}};g.fn.cell=function(){return this.css({display:"table-cell","vertical-align":"middle"})};return g.extend(c,b)})({},jQuery,window);