Simple=(function(e,g,h){var c=e,f="prototype",b={generate:function(){var k,i,j;sandbox=new c.Sandbox();sandbox.add(c.Author).add(c.Slideshow).add(c.KeyListener).init();Simple.app=sandbox;return sandbox}},d=function(){if(window.console&&window.console.log&&typeof window.console.log.apply=="function"){window.console.log.apply(window.console,arguments)}},a=function(i){return throwdown(i).toHtml()};c.Sandbox=function(){this.modules=[]};c.Sandbox[f]={add:function(i){var j=new i();j.sandbox=this;this.modules.push(j);return this},init:function(){var i=this;this.archive=new c.Archive();i.forEach("init");g("a.toggle").bind("click",function(){i.forEach("toggle")});this.bind("toggle.simple",function(){i.forEach("toggle")})},trigger:function(i,j){return g(document).trigger(i,j)},bind:function(i,j){return g(document).bind(i,j)},forEach:function(i){g.map(this.modules,function(j){if(typeof j[i]=="function"){j[i]()}})},get:function(i){return this.archive.get(i)},save:function(i){return this.archive.save(i)},load:function(i){return this.archive.load(i)},clear:function(){return this.archive.clear()}};c.Author=function(i){i=i||"#author";this.selector=i;this.$selector=g(i);this.$preview=this.$selector.find("#preview");this.$textarea=this.$selector.find("textarea");this.SLIDE_1="# Soapboax\n\nSimply slides"};c.Author[f]={init:function(){var i=this.sandbox.get("slide1")||this.SLIDE_1;this.listen();this.$textarea.val(i).change()},listen:function(){var i=this;this.$selector.delegate("textarea","keyup change",function(){var k=g(this),j=k.val();slideId=k.attr("name");g("#"+slideId).html(a(j));i.sandbox.save({key:slideId,val:j})}).delegate("a.play","click",function(){i.sandbox.trigger("play.simple")}).delegate("a.add","click",function(){var k,l,j;l=i.$preview.children().hide().last();k=l.attr("id").replace(/\d+/,function(m){return parseInt(m,10)+1});l.clone().attr("id",k).appendTo(i.$preview).show();i.$textarea.attr("name",k).val("# New Slide").change()}).delegate("a.new","click",function(){var j=i.$preview.children().first().clone();i.$preview.empty().append(j.show());i.sandbox.clear();i.$textarea.attr("name",j.attr("id")).val(i.SLIDE_1).change()})},hide:function(){this.$selector.hide()},show:function(){this.$selector.show()},toggle:function(){return this.$selector.toggle()}};c.Slideshow=function(i){i=i||"#slideshow";this.selector=i;this.$selector=g(i);this.$screen=g("#screen")};c.Slideshow[f]={init:function(){this.hide();this.listen()},listen:function(){var i=this;this.$selector.delegate("a.exit","click",function(){i.sandbox.trigger("stop.simple")});i.sandbox.bind("play.simple",function(){i.play()}).bind("loaded.simple",function(k,j){i.show()}).bind("next.simple",function(){i.next()}).bind("prev.simple",function(){i.prev()})},hide:function(){return this.$selector.hide()},show:function(){return this.$selector.show()},toggle:function(){return this.$selector.toggle()},play:function(){var i=this;i.$screen.empty();i.sandbox.load(function(j){g("<div></div>").attr("id","simple"+j.slideId).html(a(j.markdown)).appendTo(i.$screen).hide()});i.$screen.children().addClass("slide").first().cell()},next:function(){var i=this.$screen.children(":visible").hide().next();if(i.length){i.cell()}else{self.sandbox.trigger("stop.simple").trigger("toggle.simple")}},prev:function(){var i=this.$screen.children(":visible").hide().prev();if(i.length){i.cell()}else{self.sandbox.trigger("stop.simple").trigger("toggle.simple")}}};c.Archive=function(){this.db=window.localStorage||{};this.keys=[]};c.Archive[f]={save:function(i){d("Saving",i.key,i.val);return this.db[i.key]=i.val},get:function(i){return this.db[i]},load:function(l){var i="slide_",j=1,k=this.db[i+j];while(k){l({slideId:slideId,markdown:k});k=this.db[i+ ++j]}return self.sandbox.trigger("loaded.simple")},clear:function(){try{this.db.clear()}catch(i){this.db={}}}};c.KeyListener=function(){this.EDIT="edit";this.SHOW="show";this.context=this.EDIT};c.KeyListener[f]={keys:{space:32,left:37,right:39,esc:27},init:function(){var i=this,j=i.keys;i.sandbox.bind("play.simple",function(){i.context=i.SHOW}).bind("stop.simple",function(){i.context=i.EDIT}).bind("keydown",function(l){var k=l.keyCode;switch(i.context){case i.EDIT:d("keydown while editing");break;case i.SHOW:switch(k){case j.space:d("space");break;case j.left:i.sandbox.trigger("prev.simple");break;case j.right:i.sandbox.trigger("next.simple");break;case j.esc:i.sandbox.trigger("stop.simple");i.sandbox.trigger("toggle.simple");break;default:d(k);break}break}})}};g.fn.cell=function(){return this.css({display:"table-cell","vertical-align":"middle"})};return g.extend(c,b)})({},jQuery,window);