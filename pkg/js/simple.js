Simple=(function(e,f,g){var c=e,h="prototype",b={init:function(){var k,i,j;sandbox=new c.Sandbox();sandbox.add(c.Author).add(c.Slideshow).add(c.Welcome).add(c.KeyListener).init();Simple.app=sandbox;return sandbox}},d=function(){if(window.console&&window.console.log&&typeof window.console.log.apply=="function"){window.console.log.apply(window.console,arguments)}},a=function(i){return throwdown(i).toH()};c.Sandbox=function(){this.modules=[]};c.Sandbox[h]={add:function(i){var j=new i();j.sandbox=this;this.modules.push(j);return this},init:function(){var i=this;this.archive=new c.Archive();i.forEach("init");f("a.toggle").bind("click",function(){i.forEach("toggle")});this.bind("toggle.simple",function(){i.forEach("toggle")})},trigger:function(i,j){return f(document).trigger(i,j)},bind:function(i,j){return f(document).bind(i,j)},forEach:function(i){f.map(this.modules,function(j){if(typeof j[i]=="function"){j[i]()}})},load:function(j){j=j||"demo";var k=this.retrieve(j),i=this.retrieve("soapboxes");if(!k){k=[];if(j=="demo"){k=["# Create slides","with text","<h2>html</h2>","# and (some) markdown","# Any questions?"]}}if(!i){i=[j]}if(f.inArray(j,i)<0){i.push(j)}this.store("soapboxes",i);this.key=j;this.slides=k;return k},retrieve:function(i){return this.archive.retrieve(i)},get:function(i){return this.slides[i]},save:function(j,i){d("Saving",j,i);this.slides[j]=i;return this.store(this.key,this.slides)},store:function(i,j){return this.archive.store(i,j)},all:function(k){var i=0,j=this.slides[i];while(j){k({num:i,markdown:j});j=this.slides[++i]}return this},clear:function(){return this.archive.clear()}};c.Author=function(i){i=i||"#author";this.selector=i;this.$selector=f(i);this.$preview=this.$selector.find("#preview");this.$textarea=this.$selector.find("textarea");this.$paginate=this.$selector.find("#pagination")};c.Author[h]={init:function(){this.hide();this.listen()},listen:function(){var i=this;this.$selector.delegate("textarea","keyup change",function(){var k=f(this),j=k.val();slideId=k.attr("name");f("#"+slideId).html(a(j));i.sandbox.save(slideId.split("_")[1],j)}).delegate("#preview","click",function(){f(this).next().find("textarea").focus()}).delegate("a.play","click",function(){i.sandbox.trigger("play.simple");return false}).delegate("a.insert","click",function(){i.insert(i.$preview.children().length,"# New Slide");return false}).delegate("a.new","click",function(){i.createNew();return false}).delegate("#pagination a","click",function(){i.display(parseInt(f(this).html(),10)-1);return false}).delegate(".home","click",function(){return window.location.reload()});i.sandbox.bind("new.simple",function(){i.createNew()}).bind("edit.simple",function(){i.load(i.sandbox.key)})},hide:function(){return this.$selector.hide()},show:function(){return this.$selector.show()},createNew:function(){var i=this,j=prompt("Save New Slideshow As...");i.load(j);i.$preview.empty();i.$paginate.empty();i.insert(0,"# New Slideshow");i.show()},display:function(j,l){var i=this,k="slide_"+j;l=l||i.sandbox.get(j);f("div.slide").hide();f("[id$="+k+"]").show();i.$paginate.children().removeClass("current").filter(":eq("+j+")").addClass("current");i.$textarea.attr("name",k).val(l);i.$textarea.change();return this},insert:function(j,k){var i=this;f("<div></div>").attr("id","slide_"+j).attr("class","slide card padding").html(a(k)).appendTo(i.$preview).hide();f("<a href='#'></a>").html(j+1).appendTo(i.$paginate);i.sandbox.save(j,k);i.display(j);return this},toggle:function(){return this.$selector.toggle()},load:function(j){var i=this;i.sandbox.load(j);i.sandbox.all(function(k){i.insert(parseInt(k.num,10),k.markdown)});i.display(0)}};c.Slideshow=function(i){i=i||"#slideshow";this.selector=i;this.$selector=f(i);this.$screen=this.$selector.find(".screen");this.$exit=this.$selector.find(".exit")};c.Slideshow[h]={init:function(){this.hide();this.listen()},listen:function(){var i=this;this.$selector.delegate("a.exit","click",function(){i.sandbox.trigger("stop.simple")});i.sandbox.bind("play.simple",function(){i.play()}).bind("loaded.simple",function(k,j){i.show()}).bind("next.simple",function(){i.next()}).bind("prev.simple",function(){i.prev()})},hide:function(){this.$exit.hide();return this.$selector.hide()},show:function(){this.$exit.show();return this.$selector.show()},toggle:function(){this.$exit.toggle();return this.$selector.toggle()},play:function(){var i=this;i.$screen.empty();i.sandbox.all(function(j){f("<div></div>").attr("id","simple"+j.slideId).html(a(j.markdown)).appendTo(i.$screen).hide()});i.$screen.children().addClass("slide").first().cell();i.sandbox.trigger("loaded.simple")},next:function(){var i=this.$screen.children(":visible").hide().next();if(i.length){i.cell()}else{self.sandbox.trigger("stop.simple").trigger("toggle.simple")}},prev:function(){var i=this.$screen.children(":visible").hide().prev();if(i.length){i.cell()}else{self.sandbox.trigger("stop.simple").trigger("toggle.simple")}}};c.Welcome=function(i){i=i||"#welcome";this.selector=i;this.$selector=f(i);this.$screen=this.$selector.find(".screen");this.soapboxes=[]};c.Welcome[h]={init:function(){var i=this;this.show();this.$selector.delegate("a.play","click",function(){i.sandbox.load(f(this).text());i.hide();i.sandbox.trigger("edit.simple").trigger("play.simple")})},hide:function(){return this.$selector.hide()},show:function(){var i=this;this.sandbox.load();this.soapboxes=this.sandbox.retrieve("soapboxes");f.map(this.soapboxes,function(j){f("<a href='#'></a>").html(j).addClass("play").appendTo(i.$screen)});f("<hr />").appendTo(i.$screen);f("<a href='#'></a>").html("new").appendTo(i.$screen).click(function(){i.sandbox.trigger("new.simple");i.hide()});return this.$selector.show()}};c.Archive=function(){this.db=c.Archive.connection};c.Archive[h]={retrieve:function(i){var j=this.db[i];if(j){return JSON.parse(j)}else{return null}},store:function(i,j){this.db[i]=JSON.stringify(j);return this},clear:function(){try{this.db.clear()}catch(i){c.Archive.connection=window.localStorage||{}}}};c.Archive.connection=window.localStorage||{};c.KeyListener=function(){this.EDIT="edit";this.SHOW="show";this.context=this.EDIT};c.KeyListener[h]={keys:{space:32,left:37,right:39,esc:27},init:function(){var i=this,j=i.keys;i.sandbox.bind("play.simple",function(){i.context=i.SHOW}).bind("stop.simple",function(){i.context=i.EDIT}).bind("keydown",function(l){var k=l.keyCode;switch(i.context){case i.EDIT:switch(k){case j.left:i.sandbox.trigger("prev.simple");break;case j.right:i.sandbox.trigger("next.simple");break;default:d(k);break}case i.SHOW:switch(k){case j.space:d("space");break;case j.left:i.sandbox.trigger("prev.simple");break;case j.right:i.sandbox.trigger("next.simple");break;case j.esc:i.sandbox.trigger("stop.simple");i.sandbox.trigger("toggle.simple");break;default:d(k);break}break}})}};f.fn.cell=function(){return this.css({display:"table-cell","vertical-align":"middle"})};return f.extend(c,b)})({},jQuery,window);