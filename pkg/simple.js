Simple=(function(i,e,g){e.fn.dl=e.fn.delegate;e.fn.tr=e.fn.trigger;var d=i,h="prototype",f=document,b={init:function(){var l,j,k;sx=new d.Sx();sx.add(d.Au).add(d.Sw).add(d.We).add(d.Ky).init();Simple.app=sx;return sx}},c=function(){if(g.console&&g.console.log&&typeof g.console.log.apply=="function"){g.console.log.apply(g.console,arguments)}},a=function(j){return throwdown(j).toH()};d.Sx=function(){this.ms=[]};d.Sx[h]={add:function(k){var j=new k();j.sx=this;this.ms.push(j);return this},init:function(){var j=this;this.archive=new d.Archive();j.forEach("init");e("a.toggle").bind("click",function(){j.forEach("toggle")});this.bind("toggle.smp",function(){j.forEach("toggle")})},tr:function(j,k){return e(f).tr(j,k)},bind:function(j,k){return e(f).bind(j,k)},forEach:function(j){e.map(this.ms,function(k){if(typeof k[j]=="function"){k[j]()}})},load:function(j){j=j||"demo";var m=this.rt(j),l=this.rt("soapboxes");if(!m){m=[];if(j=="demo"){m=["# Create slides","with text","<h2>html</h2>","# and (some) markdown","# Any questions?"]}}if(!l){l=[j]}if(e.inArray(j,l)<0){l.push(j)}this.store("soapboxes",l);this.k=j;this.s=m;return m},rt:function(j){return this.archive.rt(j)},get:function(j){return this.s[j]},save:function(k,j){c("Saving",k,j);this.s[k]=j;return this.store(this.k,this.s)},store:function(j,l){return this.archive.store(j,l)},all:function(l){var k=0,j=this.s[k];while(j){l({num:k,mk:j});j=this.s[++k]}return this},clear:function(){return this.archive.clear()}};d.Au=function(j){j=j||"#au";this.sel=j;this.$sel=e(j);this.$pre=this.$sel.find("#pre");this.$ta=this.$sel.find("textarea");this.$pgs=this.$sel.find("#pgs")};d.Au[h]={init:function(){this.hide();this.listen()},listen:function(){var j=this;this.$sel.dl("textarea","keyup change",function(){var l=e(this),k=l.val();slideId=l.attr("name");e("#"+slideId).html(a(k));j.sx.save(slideId.split("_")[1],k)}).dl("#pre","click",function(){e(this).next().find("textarea").focus()}).dl("a.pl","click",function(){j.sx.tr("pl.smp");return false}).dl("a.ins","click",function(){j.ins(j.$pre.children().length,"# New Slide");return false}).dl("a.new","click",function(){j.createNew();return false}).dl("#pgs a","click",function(){j.display(parseInt(e(this).html(),10)-1);return false}).dl(".home","click",function(){return g.location.reload()});j.sx.bind("new.smp",function(){j.createNew()}).bind("edit.smp",function(){j.load(j.sx.k)})},hide:function(){return this.$sel.hide()},show:function(){return this.$sel.show()},createNew:function(){var j=this,k=prompt("Save New Slideshow As...");j.load(k);j.$pre.empty();j.$pgs.empty();j.ins(0,"# New Slideshow");j.show()},display:function(k,m){var j=this,l="slide_"+k;m=m||j.sx.get(k);e("div.slide").hide();e("[id$="+l+"]").show();j.$pgs.children().removeClass("current").filter(":eq("+k+")").addClass("current");j.$ta.attr("name",l).val(m);j.$ta.change();return this},ins:function(k,l){var j=this;e("<div></div>").attr("id","slide_"+k).attr("class","slide card padding").html(a(l)).appendTo(j.$pre).hide();e("<a href='#'></a>").html(k+1).appendTo(j.$pgs);j.sx.save(k,l);j.display(k);return this},toggle:function(){return this.$sel.toggle()},load:function(l){var j=this;j.sx.load(l);j.sx.all(function(k){j.ins(parseInt(k.num,10),k.mk)});j.display(0)}};d.Sw=function(j){j=j||"#sw";this.sel=j;this.$sel=e(j);this.$screen=this.$sel.find(".screen");this.$exit=this.$sel.find(".exit")};d.Sw[h]={init:function(){this.hide();this.listen()},listen:function(){var j=this;this.$sel.dl("a.exit","click",function(){j.sx.tr("stop.smp")});j.sx.bind("pl.smp",function(){j.pl()}).bind("loaded.smp",function(l,k){j.show()}).bind("next.smp",function(){j.next()}).bind("prev.smp",function(){j.prev()})},hide:function(){this.$exit.hide();return this.$sel.hide()},show:function(){this.$exit.show();return this.$sel.show()},toggle:function(){this.$exit.toggle();return this.$sel.toggle()},pl:function(){var j=this;j.$screen.empty();j.sx.all(function(k){e("<div></div>").attr("id","simple"+k.slideId).html(a(k.mk)).appendTo(j.$screen).hide()});j.$screen.children().addClass("slide").first().cell();j.sx.tr("loaded.smp")},next:function(){var j=this.$screen.children(":visible").hide().next();if(j.length){j.cell()}else{self.sx.tr("stop.smp").tr("toggle.smp")}},prev:function(){var j=this.$screen.children(":visible").hide().prev();if(j.length){j.cell()}else{self.sx.tr("stop.smp").tr("toggle.smp")}}};d.We=function(j){j=j||"#welcome";this.sel=j;this.$sel=e(j);this.$screen=this.$sel.find(".screen");this.soapboxes=[]};d.We[h]={init:function(){var j=this;this.show();this.$sel.dl("a.pl","click",function(){j.sx.load(e(this).text());j.hide();j.sx.tr("edit.smp").tr("pl.smp")})},hide:function(){return this.$sel.hide()},show:function(){var j=this;this.sx.load();this.soapboxes=this.sx.rt("soapboxes");e.map(this.soapboxes,function(k){e("<a href='#'></a>").html(k).addClass("pl").appendTo(j.$screen)});e("<hr />").appendTo(j.$screen);e("<a href='#'></a>").html("new").appendTo(j.$screen).click(function(){j.sx.tr("new.smp");j.hide()});return this.$sel.show()}};d.Archive=function(){this.db=d.Archive.connection};d.Archive[h]={rt:function(j){var l=this.db[j];if(l){return JSON.parse(l)}else{return null}},store:function(j,l){this.db[j]=JSON.stringify(l);return this},clear:function(){try{this.db.clear()}catch(j){d.Archive.connection=g.localStorage||{}}}};d.Archive.connection=g.localStorage||{};d.Ky=function(){this.EDIT="edit";this.SHOW="show";this.context=this.EDIT};d.Ky[h]={ks:{space:32,left:37,right:39,esc:27},init:function(){var j=this,k=j.ks;j.sx.bind("pl.smp",function(){j.context=j.SHOW}).bind("stop.smp",function(){j.context=j.EDIT}).bind("keydown",function(m){var l=m.keyCode;switch(j.context){case j.EDIT:c(l);break;case j.SHOW:switch(l){case k.space:c("space");break;case k.left:j.sx.tr("prev.smp");break;case k.right:j.sx.tr("next.smp");break;case k.esc:j.sx.tr("stop.smp");j.sx.tr("toggle.smp");break;default:c(l);break}break}})}};e.fn.cell=function(){return this.css({display:"table-cell","vertical-align":"middle"})};return e.extend(d,b)})({},jQuery,window);