Simple=(function(f,g,a){g.fn.dl=g.fn.delegate;var d=f,h="prototype",c={generate:function(){var k,i,j;sx=new d.Sandbox();sx.add(d.Author).add(d.Slideshow).add(d.Welcome).add(d.KeyListener).init();Simple.app=sx;return sx}},e=function(){if(a.console&&a.console.log&&typeof a.console.log.apply=="function"){a.console.log.apply(a.console,arguments)}},b=function(i){return throwdown(i).toH()};d.Sandbox=function(){this.ms=[]};d.Sandbox[h]={add:function(j){var i=new j();i.sx=this;this.ms.push(i);return this},init:function(){var i=this;this.archive=new d.Archive();i.forEach("init");g("a.toggle").bind("click",function(){i.forEach("toggle")});this.bind("toggle.simple",function(){i.forEach("toggle")})},trigger:function(i,j){return g(document).trigger(i,j)},bind:function(i,j){return g(document).bind(i,j)},forEach:function(i){g.map(this.ms,function(j){if(typeof j[i]=="function"){j[i]()}})},load:function(j){j=j||"demo";var k=this.retrieve(j),i=this.retrieve("soapboxes");if(!k){k=[];if(j=="demo"){k=["# Create slides","with text","<h2>html</h2>","# and (some) markdown","# Any questions?"]}}if(!i){i=[j]}if(g.inArray(j,i)<0){i.push(j)}this.store("soapboxes",i);this.key=j;this.s=k;return k},retrieve:function(i){return this.archive.retrieve(i)},get:function(i){return this.s[i]},save:function(j,i){e("Saving",j,i);this.s[j]=i;return this.store(this.key,this.s)},store:function(i,j){return this.archive.store(i,j)},all:function(k){var j=0,i=this.s[j];while(i){k({num:j,mk:i});i=this.s[++j]}return this},clear:function(){return this.archive.clear()}};d.Author=function(i){i=i||"#author";this.sel=i;this.$sel=g(i);this.$pre=this.$sel.find("#pre");this.$textarea=this.$sel.find("textarea");this.$paginate=this.$sel.find("#pagination")};d.Author[h]={init:function(){this.hide();this.listen()},listen:function(){var i=this;this.$sel.dl("textarea","keyup change",function(){var k=g(this),j=k.val();slideId=k.attr("name");g("#"+slideId).html(b(j));i.sx.save(slideId.split("_")[1],j)}).dl("#pre","click",function(){g(this).next().find("textarea").focus()}).dl("a.pl","click",function(){i.sx.trigger("pl.simple");return false}).dl("a.ins","click",function(){i.ins(i.$pre.children().length,"# New Slide");return false}).dl("a.new","click",function(){i.createNew();return false}).dl("#pagination a","click",function(){i.display(parseInt(g(this).html(),10)-1);return false}).dl(".home","click",function(){return a.location.reload()});i.sx.bind("new.simple",function(){i.createNew()}).bind("edit.simple",function(){i.load(i.sx.key)})},hide:function(){return this.$sel.hide()},show:function(){return this.$sel.show()},createNew:function(){var i=this,j=prompt("Save New Slideshow As...");i.load(j);i.$pre.empty();i.$paginate.empty();i.ins(0,"# New Slideshow");i.show()},display:function(j,l){var i=this,k="slide_"+j;l=l||i.sx.get(j);g("div.slide").hide();g("[id$="+k+"]").show();i.$paginate.children().removeClass("current").filter(":eq("+j+")").addClass("current");i.$textarea.attr("name",k).val(l);i.$textarea.change();return this},ins:function(j,k){var i=this;g("<div></div>").attr("id","slide_"+j).attr("class","slide card padding").html(b(k)).appendTo(i.$pre).hide();g("<a href='#'></a>").html(j+1).appendTo(i.$paginate);i.sx.save(j,k);i.display(j);return this},toggle:function(){return this.$sel.toggle()},load:function(j){var i=this;i.sx.load(j);i.sx.all(function(k){i.ins(parseInt(k.num,10),k.mk)});i.display(0)}};d.Slideshow=function(i){i=i||"#slideshow";this.sel=i;this.$sel=g(i);this.$screen=this.$sel.find(".screen");this.$exit=this.$sel.find(".exit")};d.Slideshow[h]={init:function(){this.hide();this.listen()},listen:function(){var i=this;this.$sel.dl("a.exit","click",function(){i.sx.trigger("stop.simple")});i.sx.bind("pl.simple",function(){i.pl()}).bind("loaded.simple",function(k,j){i.show()}).bind("next.simple",function(){i.next()}).bind("prev.simple",function(){i.prev()})},hide:function(){this.$exit.hide();return this.$sel.hide()},show:function(){this.$exit.show();return this.$sel.show()},toggle:function(){this.$exit.toggle();return this.$sel.toggle()},pl:function(){var i=this;i.$screen.empty();i.sx.all(function(j){g("<div></div>").attr("id","simple"+j.slideId).html(b(j.mk)).appendTo(i.$screen).hide()});i.$screen.children().addClass("slide").first().cell();i.sx.trigger("loaded.simple")},next:function(){var i=this.$screen.children(":visible").hide().next();if(i.length){i.cell()}else{self.sx.trigger("stop.simple").trigger("toggle.simple")}},prev:function(){var i=this.$screen.children(":visible").hide().prev();if(i.length){i.cell()}else{self.sx.trigger("stop.simple").trigger("toggle.simple")}}};d.Welcome=function(i){i=i||"#welcome";this.sel=i;this.$sel=g(i);this.$screen=this.$sel.find(".screen");this.soapboxes=[]};d.Welcome[h]={init:function(){var i=this;this.show();this.$sel.dl("a.pl","click",function(){i.sx.load(g(this).text());i.hide();i.sx.trigger("edit.simple").trigger("pl.simple")})},hide:function(){return this.$sel.hide()},show:function(){var i=this;this.sx.load();this.soapboxes=this.sx.retrieve("soapboxes");g.map(this.soapboxes,function(j){g("<a href='#'></a>").html(j).addClass("pl").appendTo(i.$screen)});g("<hr />").appendTo(i.$screen);g("<a href='#'></a>").html("new").appendTo(i.$screen).click(function(){i.sx.trigger("new.simple");i.hide()});return this.$sel.show()}};d.Archive=function(){this.db=d.Archive.connection};d.Archive[h]={retrieve:function(i){var j=this.db[i];if(j){return JSON.parse(j)}else{return null}},store:function(i,j){this.db[i]=JSON.stringify(j);return this},clear:function(){try{this.db.clear()}catch(i){d.Archive.connection=a.localStorage||{}}}};d.Archive.connection=a.localStorage||{};d.KeyListener=function(){this.EDIT="edit";this.SHOW="show";this.context=this.EDIT};d.KeyListener[h]={keys:{space:32,left:37,right:39,esc:27},init:function(){var i=this,j=i.keys;i.sx.bind("pl.simple",function(){i.context=i.SHOW}).bind("stop.simple",function(){i.context=i.EDIT}).bind("keydown",function(l){var k=l.keyCode;switch(i.context){case i.EDIT:switch(k){case j.left:i.sx.trigger("prev.simple");break;case j.right:i.sx.trigger("next.simple");break;default:e(k);break}case i.SHOW:switch(k){case j.space:e("space");break;case j.left:i.sx.trigger("prev.simple");break;case j.right:i.sx.trigger("next.simple");break;case j.esc:i.sx.trigger("stop.simple");i.sx.trigger("toggle.simple");break;default:e(k);break}break}})}};g.fn.cell=function(){return this.css({display:"table-cell","vertical-align":"middle"})};return g.extend(d,c)})({},jQuery,window);